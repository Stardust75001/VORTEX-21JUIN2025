// sentry-bundle.tracing.min.js
(function () {
  if (!window.Sentry) {
    console.warn("[Sentry] SDK not loaded");
    return;
  }

  Sentry.init({
    dsn: 'https://...ton-dsn...ingest.sentry.io/...',
    integrations: [new Sentry.BrowserTracing()],
    tracesSampleRate: 0.1,
    debug: true,
    beforeSend(event, hint) {
      const error = hint.originalException;
      if (error && typeof error.message === 'string' && error.message.includes("Test de vérification manuelle Sentry")) {
        console.warn("⛔ Erreur de test ignorée :", error.message);
        return null;
      }
      return event;
    },
    environment: "{{ request.env | default: 'production' }}",
  });

  {% if customer %}
    Sentry.setUser({
      id: "{{ customer.id }}",
      email: "{{ customer.email }}",
      username: "{{ customer.first_name | append: ' ' | append: customer.last_name }}",
    });
  {% endif %}

  console.log("✅ Sentry initialized");
})();