// sentry-bundle.tracing.min.js
// Version allégée avec initialisation Sentry + BrowserTracing (non minifié pour débogage facile)
(function () {
  if (!window.Sentry) {
    console.warn("[Sentry] SDK not loaded");
    return;
  }

  Sentry.init({
    dsn: 'https://011a0ff43ae59d78bdad9dc3dd9b6bb9@o4509330673303552.ingest.de.sentry.io/4509330707972176',
    integrations: [new Sentry.BrowserTracing()],
    tracesSampleRate: 0.1,
    debug: false,
    beforeSend(event, hint) {
      const error = hint?.originalException;
      if (error && typeof error.message === 'string' && error.message.includes("Test de vérification manuelle Sentry")) {
        console.warn("⛔ Erreur de test ignorée :", error.message);
        return null;
      }
      return event;
    }
  });

  Sentry.setTag("shop_locale", "{{ request.locale.iso_code }}");

  {% if customer %}
  Sentry.setUser({
    id: "{{ customer.id }}",
    email: "{{ customer.email }}",
    username: "{{ customer.first_name | append: ' ' | append: customer.last_name }}"
  });
  {% endif %}

  console.log("✅ Sentry initialized");
})();